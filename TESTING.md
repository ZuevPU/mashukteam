# Руководство по тестированию

## Подготовка к тестированию

### 1. Применение миграций

Убедитесь, что все миграции применены к базе данных Supabase:

```bash
# В Supabase Dashboard перейдите в SQL Editor и выполните миграции по порядку:
# 001_create_users_table.sql
# 002_create_gamification_tables.sql
# 003_create_events_system.sql
# 004_add_event_status.sql
# 005_advanced_features.sql
# 006_create_assignments_system.sql
# 007_enable_rls_policies.sql
# 008_add_directions_system.sql
# 009_add_reflection_levels.sql
# 010_add_event_groups.sql
# 011_fix_user_statuses.sql
# 012_make_motivation_optional.sql
```

### 2. Наполнение тестовыми данными

Выполните скрипт `scripts/seed_test_data.sql` в Supabase SQL Editor для создания тестовых данных:

- 5 направлений
- 4 типа пользователей
- 5 мероприятий (сгруппированных по дням)
- 2 диагностики
- 3 задания
- 4 персональных вопроса

### 3. Установка зависимостей

```bash
# Backend
cd backend
npm install

# Frontend
cd frontend
npm install
```

### 4. Настройка переменных окружения

Убедитесь, что настроены все необходимые переменные окружения в `.env` файлах (см. `.env.example`).

## Чек-лист тестирования

### Регистрация и авторизация
- [ ] Регистрация нового пользователя через Telegram Mini App
- [ ] Авторизация существующего пользователя
- [ ] Выбор направления при первом входе
- [ ] Пропуск выбора направления (опционально)

### Профиль пользователя
- [ ] Отображение информации о пользователе
- [ ] Отображение типа пользователя
- [ ] Отображение направления
- [ ] Отображение уровня рефлексии

### Мероприятия
- [ ] Просмотр списка мероприятий
- [ ] Группировка мероприятий по дням
- [ ] Переключение между вкладками "Анонсы" и "История"
- [ ] Просмотр деталей мероприятия
- [ ] Ответ на вопросы мероприятия
- [ ] Начисление баллов рефлексии за ответ (+2 балла)

### Диагностика
- [ ] Просмотр списка диагностик
- [ ] Прохождение диагностики
- [ ] Ответ на вопросы диагностики
- [ ] Начисление баллов рефлексии за ответ (+3 балла)

### Персональные вопросы
- [ ] Просмотр списка персональных вопросов
- [ ] Ответ на вопрос с открытым ответом (text)
- [ ] Ответ на вопрос с выбором одного варианта (single)
- [ ] Ответ на вопрос с выбором нескольких вариантов (multiple)
- [ ] Ответ на вопрос со шкалой (scale)
- [ ] Начисление баллов рефлексии за ответ (+1 балл)

### Задания
- [ ] Просмотр списка заданий
- [ ] Отправка выполнения задания
- [ ] Просмотр статуса задания
- [ ] Начисление баллов рефлексии при одобрении (+5 баллов)

### Прогресс рефлексии
- [ ] Отображение текущего уровня рефлексии
- [ ] Отображение прогресс-бара
- [ ] Проверка перехода на следующий уровень при достижении порога
- [ ] Проверка названий уровней:
  - Уровень 1 (0-20): "Начал задумываться"
  - Уровень 2 (21-50): "Поймал смысл"
  - Уровень 3 (51-100): "Опять рефлексирует"
  - Уровень 4 (101-200): "Уже хватит рефлексировать"
  - Уровень 5 (201+): "Мастер рефлексии"

### Админ-панель

#### Управление мероприятиями
- [ ] Создание нового мероприятия
- [ ] Указание группы мероприятия (group_name)
- [ ] Указание порядка группы и мероприятия
- [ ] Редактирование мероприятия
- [ ] Удаление мероприятия
- [ ] Добавление вопросов к мероприятию
- [ ] Просмотр аналитики мероприятия

#### Управление диагностиками
- [ ] Создание новой диагностики
- [ ] Группировка диагностик
- [ ] Редактирование диагностики
- [ ] Добавление вопросов к диагностике

#### Управление заданиями
- [ ] Создание нового задания
- [ ] Указание формата ответа (text, number, link)
- [ ] Указание награды
- [ ] Таргетирование задания (all, user_type, individual)
- [ ] Отправка уведомления при создании
- [ ] Модерация выполненных заданий
- [ ] Просмотр всех ответов на задание

#### Управление персональными вопросами
- [ ] Просмотр списка вопросов
- [ ] Создание нового вопроса
- [ ] Выбор типа вопроса (text, single, multiple, scale)
- [ ] Таргетирование вопроса (all, by_type, individual)
- [ ] Отправка уведомления при создании
- [ ] Просмотр ответов на вопросы

#### Управление пользователями
- [ ] Просмотр списка пользователей
- [ ] Просмотр деталей пользователя
- [ ] Изменение типа пользователя
- [ ] Изменение направления пользователя
- [ ] Просмотр ответов пользователя на мероприятия
- [ ] Просмотр ответов пользователя на диагностики
- [ ] Просмотр ответов пользователя на персональные вопросы
- [ ] Просмотр выполненных заданий пользователя

#### Управление направлениями
- [ ] Просмотр списка направлений
- [ ] Создание нового направления
- [ ] Редактирование направления
- [ ] Удаление направления

#### Экспорт данных
- [ ] Выгрузка всех ответов в Excel
- [ ] Проверка наличия всех листов в файле:
  - Лист "Мероприятия"
  - Лист "Персональные вопросы"
  - Лист "Задания"
- [ ] Проверка корректности данных в файле

### Уведомления
- [ ] Уведомление о новом мероприятии
- [ ] Уведомление о новом задании
- [ ] Уведомление о новом персональном вопросе
- [ ] Уведомление о результате проверки задания
- [ ] Уведомление о назначении направления
- [ ] Проверка наличия ссылки на приложение в уведомлениях

## Известные проблемы и ограничения

1. **Выгрузка в Excel**: Требует установки библиотеки `xlsx` в backend. Выполните `npm install` в папке backend.

2. **Уведомления**: Для работы уведомлений необходимо настроить `TELEGRAM_BOT_TOKEN` в переменных окружения backend.

3. **RLS политики**: Убедитесь, что все RLS политики применены корректно. Backend использует `service_role` ключ, который обходит RLS.

## Рекомендации по тестированию

1. **Поэтапное тестирование**: Начните с базовых функций (регистрация, просмотр), затем переходите к более сложным (создание контента, модерация).

2. **Тестирование на разных устройствах**: Проверьте работу приложения на разных устройствах и в разных браузерах.

3. **Тестирование производительности**: При большом количестве данных проверьте скорость загрузки списков и экспорта.

4. **Тестирование безопасности**: Убедитесь, что обычные пользователи не могут получить доступ к админ-функциям.

## Отчет об ошибках

При обнаружении ошибок укажите:
- Описание проблемы
- Шаги для воспроизведения
- Ожидаемое поведение
- Фактическое поведение
- Скриншоты (если применимо)
- Логи из консоли браузера/сервера
